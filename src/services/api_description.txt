Wishlist API Description
1ï¸âƒ£ Add product to wishlist

API: POST /api/wishlist

Description:
ThÃªm má»™t sáº£n pháº©m vÃ o danh sÃ¡ch yÃªu thÃ­ch (wishlist) cá»§a ngÆ°á»i dÃ¹ng hiá»‡n táº¡i.

Náº¿u ngÆ°á»i dÃ¹ng chÆ°a cÃ³ wishlist, há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng táº¡o má»›i.

Náº¿u sáº£n pháº©m Ä‘Ã£ tá»“n táº¡i trong wishlist, API sáº½ tráº£ vá» lá»—i.

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p (JWT â€“ req.user.id)

Request Body:

{
  "productId": "string"
}


Response â€“ Success (200):

{
  "message": "Product added to wishlist",
  "data": {
    "_id": "wishlistId",
    "userId": "userId",
    "items": [
      {
        "productId": {
          "_id": "productId",
          "title": "Product title",
          "brand": "Brand name",
          "description": "Product description",
          "images": []
        },
        "addedAt": "2026-01-13T10:00:00.000Z"
      }
    ]
  }
}


Response â€“ Error:

404 â€“ Product not found

400 â€“ Product already in wishlist

500 â€“ Server error

2ï¸âƒ£ Get wishlist

API: GET /api/wishlist

Description:
Láº¥y danh sÃ¡ch sáº£n pháº©m trong wishlist cá»§a ngÆ°á»i dÃ¹ng.

Má»—i sáº£n pháº©m tráº£ vá» áº£nh vÃ  giÃ¡ cá»§a variant Ä‘áº§u tiÃªn.

Tá»± Ä‘á»™ng loáº¡i bá» sáº£n pháº©m Ä‘Ã£ bá»‹ xÃ³a khá»i há»‡ thá»‘ng.

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

Response â€“ Success (200):

{
  "success": true,
  "data": [
    {
      "wishlistItemId": "itemId",
      "productId": "productId",
      "title": "Product title",
      "brand": "Brand name",
      "image": "image_url",
      "price": 199000,
      "addedAt": "2026-01-13T10:00:00.000Z"
    }
  ]
}


Response â€“ Empty Wishlist (200):

{
  "success": true,
  "data": []
}


Response â€“ Error:

500 â€“ Failed to fetch wishlist

3ï¸âƒ£ Check product in wishlist

API: GET /api/wishlist/check/:productId

Description:
Kiá»ƒm tra xem má»™t sáº£n pháº©m cÃ³ tá»“n táº¡i trong wishlist cá»§a ngÆ°á»i dÃ¹ng hay khÃ´ng.
API nÃ y thÆ°á»ng Ä‘Æ°á»£c dÃ¹ng Ä‘á»ƒ:

Hiá»ƒn thá»‹ tráº¡ng thÃ¡i â€œâ¤ï¸ ÄÃ£ yÃªu thÃ­châ€

Disable nÃºt thÃªm wishlist á»Ÿ frontend

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

URL Params:

productId: string


Response â€“ Success (200):

{
  "exists": true
}

4ï¸âƒ£ Remove product from wishlist

API: DELETE /api/wishlist/:productId

Description:
XÃ³a má»™t sáº£n pháº©m khá»i wishlist cá»§a ngÆ°á»i dÃ¹ng báº±ng $pull trong MongoDB.

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

URL Params:

productId: string


Response â€“ Success (200):

{
  "message": "Product removed from wishlist successfully"
}


Response â€“ Error:

400 â€“ Invalid Product ID

404 â€“ Product not found in wishlist

500 â€“ Server error

5ï¸âƒ£ Clear wishlist

API: DELETE /api/wishlist

Description:
XÃ³a toÃ n bá»™ sáº£n pháº©m trong wishlist cá»§a ngÆ°á»i dÃ¹ng (lÃ m rá»—ng máº£ng items).

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

Response â€“ Success (200):

{
  "message": "Wishlist cleared successfully",
  "data": []
}


Response â€“ Error:

404 â€“ Wishlist not found

500 â€“ Server error

ğŸ”’ Notes & Constraints

Má»—i ngÆ°á»i dÃ¹ng chá»‰ cÃ³ má»™t wishlist duy nháº¥t.

Má»—i sáº£n pháº©m chá»‰ Ä‘Æ°á»£c thÃªm má»™t láº§n vÃ o wishlist.

Dá»¯ liá»‡u sáº£n pháº©m Ä‘Æ°á»£c láº¥y thÃ´ng qua populate tá»« ProductModel.

GiÃ¡ vÃ  áº£nh hiá»ƒn thá»‹ dá»±a trÃªn variant Ä‘áº§u tiÃªn cá»§a sáº£n pháº©m.






Product API Description
1ï¸âƒ£ Add Product

API: POST /api/products

Description:
Táº¡o má»›i má»™t sáº£n pháº©m trong há»‡ thá»‘ng.

Kiá»ƒm tra categoryId cÃ³ tá»“n táº¡i hay khÃ´ng

LÆ°u sáº£n pháº©m kÃ¨m variants

XÃ³a cache danh sÃ¡ch sáº£n pháº©m

Gá»­i notification cho ngÆ°á»i táº¡o sáº£n pháº©m

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p (JWT)

Request Body:

{
  "title": "string",
  "brand": "string",
  "description": "string",
  "descriptionDetail": "string",
  "specifications": {},
  "variants": [],
  "categoryId": "string",
  "isHide": 0,
  "rating": 5
}


Response â€“ Success (201):

{
  "success": true,
  "message": "Add product successfully",
  "data": {
    "_id": "productId",
    "title": "Product title",
    "brand": "Brand name",
    "categoryId": "categoryId",
    "variants": []
  }
}


Response â€“ Error:

400 â€“ Category does not exist

409 â€“ SKU already exists in another product variant

500 â€“ Internal Server Error

2ï¸âƒ£ Get All Products

API: GET /api/products

Description:
Láº¥y danh sÃ¡ch sáº£n pháº©m cÃ´ng khai (isHide = PUBLIC) kÃ¨m phÃ¢n trang, lá»c vÃ  sáº¯p xáº¿p.

Há»— trá»£ cache Redis

Lá»c theo category

Lá»c theo khoáº£ng giÃ¡

Sáº¯p xáº¿p theo giÃ¡ tÄƒng / giáº£m

Query Parameters:

page       : number (optional)
sort       : PRICE_ASC | PRICE_DESC (optional)
idCategory : string (optional)
minPrice  : number (optional)
maxPrice  : number (optional)


Response â€“ Success (200):

{
  "data": [
    {
      "_id": "productId",
      "title": "Product title",
      "salePricePre": 199000
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}


Response â€“ Error:

400 â€“ Invalid page number / Invalid category id

500 â€“ Failed to fetch products

3ï¸âƒ£ Get Product By ID

API: GET /api/products/:id

Description:
Láº¥y chi tiáº¿t má»™t sáº£n pháº©m theo ID.

Chá»‰ tráº£ vá» sáº£n pháº©m á»Ÿ tráº¡ng thÃ¡i PUBLIC

URL Params:

id: string


Response â€“ Success (200):

{
  "_id": "productId",
  "title": "Product title",
  "brand": "Brand name",
  "variants": []
}


Response â€“ Error:

400 â€“ Invalid product id

404 â€“ Product not found

500 â€“ Failed to fetch product

4ï¸âƒ£ Update Product

API: PUT /api/products/:id

Description:
Cáº­p nháº­t thÃ´ng tin sáº£n pháº©m.

Cho phÃ©p update linh hoáº¡t cÃ¡c trÆ°á»ng

XÃ³a cache Redis sau khi cáº­p nháº­t

Gá»­i notification cáº­p nháº­t sáº£n pháº©m

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

URL Params:

id: string


Request Body:
(ToÃ n bá»™ cÃ¡c field cáº§n cáº­p nháº­t)

Response â€“ Success (200):

{
  "_id": "productId",
  "title": "Updated product title",
  "brand": "Updated brand"
}


Response â€“ Error:

400 â€“ Invalid product id

404 â€“ Product not found

500 â€“ Failed to update product

5ï¸âƒ£ Change Product Status

API: PATCH /api/products/:id/status

Description:
Thay Ä‘á»•i tráº¡ng thÃ¡i hiá»ƒn thá»‹ cá»§a sáº£n pháº©m.
CÃ¡c tráº¡ng thÃ¡i há»£p lá»‡:

CREATE

PUBLIC

HIDE

Sau khi cáº­p nháº­t:

XÃ³a cache Redis

Gá»­i notification

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

URL Params:

id: string


Request Body:

{
  "to": 1
}


Response â€“ Success (200):

{
  "message": "Change status to PUBLIC successfully"
}


Response â€“ Error:

400 â€“ Invalid product id / Invalid status value

404 â€“ Product not found

500 â€“ Failed to change status

ğŸ”’ Notes & Design Decisions

Chá»‰ sáº£n pháº©m á»Ÿ tráº¡ng thÃ¡i PUBLIC má»›i Ä‘Æ°á»£c hiá»ƒn thá»‹ cho ngÆ°á»i dÃ¹ng

Redis cache giÃºp tá»‘i Æ°u truy váº¥n danh sÃ¡ch sáº£n pháº©m

Cache Ä‘Æ°á»£c xÃ³a má»—i khi:

ThÃªm sáº£n pháº©m

Cáº­p nháº­t sáº£n pháº©m

Thay Ä‘á»•i tráº¡ng thÃ¡i sáº£n pháº©m

Notification Ä‘Æ°á»£c gá»­i cho cÃ¡c hÃ nh Ä‘á»™ng quáº£n trá»‹ sáº£n pháº©m


ğŸ‘¤ Authentication API Description
1ï¸âƒ£ Register User

API: POST /api/auth/register

Description:
ÄÄƒng kÃ½ tÃ i khoáº£n ngÆ°á»i dÃ¹ng má»›i.

Kiá»ƒm tra email Ä‘Ã£ tá»“n táº¡i hay chÆ°a

Máº­t kháº©u Ä‘Æ°á»£c mÃ£ hÃ³a báº±ng bcrypt trÆ°á»›c khi lÆ°u

LÆ°u thÃ´ng tin cÆ¡ báº£n cá»§a ngÆ°á»i dÃ¹ng vÃ o há»‡ thá»‘ng

Authentication:
âŒ KhÃ´ng yÃªu cáº§u (Public)

Request Body:

{
  "username": "string",
  "password": "string",
  "email": "string",
  "phoneNumber": "string",
  "dateOfBirth": "YYYY-MM-DD",
  "address": []
}


Response â€“ Success (201):

{
  "message": "User registered successfully"
}


Response â€“ Error:

403 â€“ User already exists

500 â€“ Internal server error

2ï¸âƒ£ Login User

API: POST /api/auth/login

Description:
XÃ¡c thá»±c ngÆ°á»i dÃ¹ng báº±ng email vÃ  máº­t kháº©u.

So sÃ¡nh máº­t kháº©u vá»›i hash trong database

Sinh Access Token vÃ  Refresh Token báº±ng JWT

LÆ°u token vÃ o HTTP-only Cookie

Tráº£ vá» thÃ´ng tin cÆ¡ báº£n cá»§a ngÆ°á»i dÃ¹ng

Authentication:
âŒ KhÃ´ng yÃªu cáº§u (Public)

Request Body:

{
  "email": "string",
  "password": "string"
}


Response â€“ Success (200):

{
  "message": "Login successful",
  "user": {
    "id": "userId",
    "role": "USER",
    "email": "user@example.com"
  }
}


Cookies Set:

access_token (TTL: 24 hours)

refresh_token (TTL: 30 days)

Both cookies:

httpOnly: true

secure: true (production)

sameSite: lax

Response â€“ Error:

401 â€“ Invalid email or password

500 â€“ Internal server error

ğŸ” Token Strategy

Access Token

Thá»i háº¡n: 24 giá»

DÃ¹ng cho cÃ¡c API yÃªu cáº§u xÃ¡c thá»±c

Refresh Token

Thá»i háº¡n: 30 ngÃ y

LÆ°u dÆ°á»›i dáº¡ng HTTP-only cookie

DÃ¹ng Ä‘á»ƒ cáº¥p láº¡i Access Token (chÆ°a implement)

ğŸ§© User Data Stored

userName

email

password (bcrypt hash)

phoneNumber

dateOfBirth

address

role (máº·c Ä‘á»‹nh)

ğŸ”’ Security Notes

Máº­t kháº©u khÃ´ng bao giá» lÆ°u plain text

Token lÆ°u trong cookie giÃºp giáº£m rá»§i ro XSS

So sÃ¡nh máº­t kháº©u sá»­ dá»¥ng bcrypt.compare

JWT payload chá»©a thÃ´ng tin tá»‘i thiá»ƒu (id, role, email)

ğŸš§ Features Not Implemented (Commented Code)

Refresh token rotation

Logout & revoke refresh token

Session-based token storage



Order API Description
1ï¸âƒ£ Get Order Detail With Product Info

API: GET /api/orders/:orderId/detail

Description:
Láº¥y chi tiáº¿t Ä‘Æ¡n hÃ ng kÃ¨m thÃ´ng tin Ä‘áº§y Ä‘á»§ cá»§a sáº£n pháº©m.

Join báº£ng products Ä‘á»ƒ láº¥y thÃ´ng tin tá»«ng sáº£n pháº©m trong Ä‘Æ¡n

Tráº£ vá» productDetail tÆ°Æ¡ng á»©ng vá»›i tá»«ng productId

Convert _id sang string Ä‘á»ƒ frontend dá»… xá»­ lÃ½

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

URL Params:

orderId: string


Response â€“ Success (200):

{
  "_id": "orderId",
  "sumPrice": 2500000,
  "listProduct": [
    {
      "productId": "productId",
      "variantId": "variantId",
      "quantity": 2,
      "price": 1200000,
      "productDetail": {
        "_id": "productId",
        "title": "Product title",
        "brand": "Brand name"
      }
    }
  ]
}

2ï¸âƒ£ Create Order From Cart

API: POST /api/orders/from-cart

Description:
Táº¡o Ä‘Æ¡n hÃ ng tá»« giá» hÃ ng hiá»‡n táº¡i cá»§a ngÆ°á»i dÃ¹ng.

Sá»­ dá»¥ng MongoDB Transaction Ä‘á»ƒ Ä‘áº£m báº£o toÃ n váº¹n dá»¯ liá»‡u

Láº¥y variant cá»¥ thá»ƒ tá»« cart

TÃ­nh giÃ¡ cuá»‘i cÃ¹ng dá»±a trÃªn variant.price / salePrice

XÃ³a toÃ n bá»™ cart sau khi táº¡o Ä‘Æ¡n thÃ nh cÃ´ng

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

Request Body:

{
  "toAddress": "string",
  "note": "string"
}


Business Rules:

Bá» qua sáº£n pháº©m hoáº·c variant Ä‘Ã£ bá»‹ xÃ³a

Náº¿u cart trá»‘ng â†’ lá»—i

GiÃ¡ Ä‘Æ°á»£c â€œÄ‘Ã³ng bÄƒngâ€ táº¡i thá»i Ä‘iá»ƒm táº¡o Ä‘Æ¡n

Response â€“ Success (201):

{
  "_id": "orderId",
  "sumPrice": 3500000,
  "statusOrder": "ORDERED"
}


Response â€“ Error:

400 â€“ Cart is empty

500 â€“ Failed to create order

3ï¸âƒ£ Create Order (Manual / Admin / COD)

API: POST /api/orders

Description:
Táº¡o Ä‘Æ¡n hÃ ng trá»±c tiáº¿p (khÃ´ng qua cart).

DÃ¹ng cho admin hoáº·c ká»‹ch báº£n Ä‘áº·c biá»‡t

Tráº¡ng thÃ¡i Ä‘Æ¡n máº·c Ä‘á»‹nh: ORDERED

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p (Admin / Staff)

Request Body:

{
  "listProduct": [],
  "userId": "userId",
  "sumPrice": 1000000,
  "note": "string",
  "toAddress": "string",
  "numberPhone": "string",
  "userName": "string"
}

4ï¸âƒ£ Get User Visible Orders

API: GET /api/orders/my-orders

Description:
Láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng há»£p lá»‡ cá»§a ngÆ°á»i dÃ¹ng.

Logic há»£p lá»‡:

COD: Cho phÃ©p cÃ¡c tráº¡ng thÃ¡i (PROCESSING, SHIPPING, DELIVERED, RETURNED)

Stripe: Chá»‰ láº¥y Ä‘Æ¡n Ä‘Ã£ thanh toÃ¡n thÃ nh cÃ´ng (PAID)

Authentication:
âœ” YÃªu cáº§u Ä‘Äƒng nháº­p

Response â€“ Success (200):

[
  {
    "_id": "orderId",
    "sumPrice": 2000000,
    "statusOrder": "SHIPPING",
    "payment": {
      "method": "COD",
      "status": "PENDING"
    }
  }
]

5ï¸âƒ£ Get User Cancelled Orders

API: GET /api/orders/cancelled

Description:
Láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng Ä‘Ã£ bá»‹ há»§y cá»§a ngÆ°á»i dÃ¹ng.

6ï¸âƒ£ Get User Returned Orders

API: GET /api/orders/returned

Description:
Láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng Ä‘Ã£ hoÃ n tráº£ cá»§a ngÆ°á»i dÃ¹ng.

7ï¸âƒ£ Get User Delivered Orders

API: GET /api/orders/delivered

Description:
Láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng Ä‘Ã£ giao thÃ nh cÃ´ng cá»§a ngÆ°á»i dÃ¹ng.

8ï¸âƒ£ [ADMIN] Get All Valid Orders

API: GET /api/admin/orders

Description:
Admin láº¥y danh sÃ¡ch Ä‘Æ¡n hÃ ng há»£p lá»‡, Ä‘Ã£ lá»c bá» Ä‘Æ¡n rÃ¡c.

Anti-Spam Rules:

COD: Cho phÃ©p nhiá»u tráº¡ng thÃ¡i

Stripe: Chá»‰ láº¥y Ä‘Æ¡n PAID

Query Parameters:

page   : number
limit  : number
status : ORDERED | PROCESSING | SHIPPING | DELIVERED | RETURNED | CANCELLED
search : orderId


Response â€“ Success (200):

{
  "orders": [
    {
      "_id": "orderId",
      "sumPrice": 2500000,
      "statusOrder": "PROCESSING",
      "userId": {
        "_id": "userId",
        "email": "user@email.com",
        "fullName": "Nguyen Van A",
        "phone": "0123456789"
      }
    }
  ],
  "total": 120,
  "currentPage": 1,
  "totalPages": 12,
  "itemsPerPage": 10
}

9ï¸âƒ£ Get Orders By Payment Status

API: GET /api/admin/orders/payment-status

Description:
Lá»c Ä‘Æ¡n hÃ ng theo tráº¡ng thÃ¡i thanh toÃ¡n (Admin).

Query Parameters:

paymentStatus : PAID | UNPAID | PENDING
page          : number
limit         : number
search        : string


Response â€“ Success (200):

{
  "data": [
    {
      "_id": "orderId",
      "sumPrice": 1500000,
      "payment": {
        "method": "STRIPE",
        "status": "PAID"
      }
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 25,
    "totalPages": 3
  }
}

ğŸ” Transaction & Data Integrity

Sá»­ dá»¥ng MongoDB Transaction (Session)

Äáº£m báº£o:

KhÃ´ng táº¡o Ä‘Æ¡n khi cart rá»—ng

KhÃ´ng máº¥t dá»¯ liá»‡u khi lá»—i giá»¯a chá»«ng

Cart chá»‰ bá»‹ xÃ³a khi order táº¡o thÃ nh cÃ´ng
